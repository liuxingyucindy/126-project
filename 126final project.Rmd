---
title: "126 final project"
author: "Rebecca Ji, Cindy Liu, Linna He"
date: "2020/6/8"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

link to the data set: https://archive.ics.uci.edu/ml/datasets/student%2Bperformance#


```{r}
#importing data
##我这里加了scatterplot，但是没有av plot
d1=read.table("student-mat.csv",sep=";",header=TRUE)
d2 <- subset(d1, G3!=0)
#plot(d2$G3,  d2$G2)
lm1 <-lm (G3~G1+G2, data = d2)
plot(lm1)

```

```{r}
attach(d1)
#Variable selection I
#forward selection with aic
mod.0 <- lm(G3~1, data=d2)
mod.full <- lm(G3 ~., data=d2) 
step(mod.0, scope=list(lower=mod.0, upper=mod.full), direction = "forward", trace=0)
#result: G3 ~ G2 + G1 + famrel + goout + health + absences + paid

#forward selection with bic
n <- length(d2$G3)
step(mod.0,scope = list(lower=mod.0,upper=mod.full), direction = "forward", k=log(n),trace=0)
#result: G3 ~ G2 + G1 + famrel

#backward selection with aic
step(mod.full, scope=list(lower=mod.0, upper=mod.full), direction = "backward", trace=0)
#result: G3 ~ paid + famrel + goout + health + absences + G1 + G2

#backward selection with bic
step(mod.full, scope=list(lower=mod.0, upper=mod.full), direction = "backward", k=log(n),trace=0)
#result: G3 ~ famrel + G1 + G2

#stepwise selection
step(mod.0,scope = list(lower=mod.0,upper=mod.full),trace=0)
#result: G3 ~ G2 + G1 + famrel + goout + health + absences + paid

```

```{r}
#scattor plot
pairs(~G3 + G2 + G1 + famrel + goout + health + absences + paid)
#There might be linear relationship between G3 and G1, G2 and G1, and G2 and G3.
```

```{r}
#Variable selection II
library(leaps)
mod.reg <- regsubsets(cbind(G2, G1, famrel, goout, health, absences, paid),G3, data=d2)
summary.reg<- summary(mod.reg)
summary.reg$which

#by plots
par(mfrow = c(2, 2))
plot(summary.reg$rsq, xlab = "Number of Variables", ylab = "RSq", type = "b")

plot(summary.reg$adjr2, xlab = "Number of Variables", ylab = "Adjusted RSq", type = "b")
best_adj_r2 = which.max(summary.reg$adjr2)
points(best_adj_r2, summary.reg$adjr2[best_adj_r2],
       col = "red",cex = 2, pch = 20)

plot(summary.reg$cp, xlab = "Number of Variables", ylab = "Cp", type = 'b')
best_cp = which.min(summary.reg$cp[-c(length(summary.reg$cp))])
points(best_cp, summary.reg$cp[best_cp],
       col = "red", cex = 2, pch = 20)

plot(summary.reg$bic, xlab = "Number of Variables", ylab = "BIC", type = 'b')
best_bic = which.min(summary.reg$bic)
points(best_bic, summary.reg$bic[best_bic],
       col = "red", cex = 2, pch = 20)

```


```{r}
#AV plots for model with 5 potential predictors
library(alr4)
full.5<-lm(G3 ~ G2+G1+famrel+health+absences,data=d2)
avPlots(full.5, id=FALSE)
summary(full.5)
```

```{r}
#test for outliers
##这个应该要看你的code
outlierTest(full.5)
```


```{r}
#transform
boxCox(full.5)
#no need of transformation
```

```{r}
##这个也是你的code
#new clean data set d3
d3 <-d2[-c(44,46, 62,101,217), ]

full.5.1<-lm(G3 ~ G2+G1+famrel+health+absences,data=d3)

summary(full.5.1)
plot(full.5.1)

#sbtract predictor health and absences.
full.5.2<-lm(G3 ~ G2+G1+famrel,data=d3)

summary(full.5.2)
plot(full.5.2)
```

